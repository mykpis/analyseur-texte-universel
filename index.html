<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyseur de Texte Universel - Universal Text Analyzer</title>
    <meta name="description" content="Application web intelligente pour l'analyse et la cat√©gorisation automatique de r√©ponses textuelles avec support du dialecte marocain (darija)">
    <meta name="keywords" content="analyse texte, darija, marocain, dialecte, traduction, correspondances, excel">
    <meta name="author" content="Votre Nom">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://votrenom.github.io/analyseur-texte-universel/">
    <meta property="og:title" content="Analyseur de Texte Universel">
    <meta property="og:description" content="Outil intelligent pour analyser et cat√©goriser automatiquement des r√©ponses textuelles">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://votrenom.github.io/analyseur-texte-universel/">
    <meta property="twitter:title" content="Analyseur de Texte Universel">
    <meta property="twitter:description" content="Outil intelligent pour analyser et cat√©goriser automatiquement des r√©ponses textuelles">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }
        .header h1 {
            color: #333;
            margin: 0;
            font-size: 2.5em;
        }
        .header p {
            color: #666;
            margin: 10px 0;
            font-size: 1.1em;
        }
        .github-link {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
        }
        .github-link:hover {
            background: #555;
            transform: translateY(-2px);
        }
        .version-info {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .limitations {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .limitations h4 {
            margin-top: 0;
            color: #f57c00;
        }
        
        /* Mode Selector */
        .mode-selector {
            margin: 30px 0;
        }
        .mode-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .mode-card {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background: #f8f9fa;
        }
        .mode-card:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
        .mode-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: scale(1.02);
        }
        .mode-card h4 {
            margin: 0 0 10px 0;
            font-size: 1.3em;
        }
        .mode-card p {
            margin: 0;
            opacity: 0.8;
        }

        /* Configuration Panels */
        .config-panel {
            display: none;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid #667eea;
        }
        .config-panel.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* File Upload */
        .file-upload {
            margin: 15px 0;
            padding: 15px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            text-align: center;
            transition: border-color 0.3s;
        }
        .file-upload:hover {
            border-color: #667eea;
        }
        .file-upload input[type="file"] {
            margin: 10px 0;
        }
        .file-uploaded {
            border-color: #28a745;
            background-color: #d4edda;
        }

        /* Parameters */
        .parameters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .param-group {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        .param-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        .param-group input, .param-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }

        /* Learning Interface */
        .learning-interface {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #667eea;
        }
        .sample-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #667eea;
        }
        .sample-response {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .suggested-categories {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 10px 0;
        }
        .category-tag {
            background: #667eea;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .category-tag:hover {
            background: #5a6fd8;
        }
        .category-tag.rejected {
            background: #dc3545;
            text-decoration: line-through;
        }

        /* Status and Results */
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-weight: 500;
        }
        .status.info { background-color: #d1ecf1; color: #0c5460; border-left: 4px solid #17a2b8; }
        .status.success { background-color: #d4edda; color: #155724; border-left: 4px solid #28a745; }
        .status.warning { background-color: #fff3cd; color: #856404; border-left: 4px solid #ffc107; }
        .status.error { background-color: #f8d7da; color: #721c24; border-left: 4px solid #dc3545; }

        .button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px 5px;
            transition: all 0.3s;
        }
        .button:hover { 
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        .button:disabled { 
            background: #6c757d; 
            cursor: not-allowed; 
            transform: none;
            box-shadow: none;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border-left: 4px solid #667eea;
            transition: transform 0.3s;
        }
        .stat-card:hover {
            transform: scale(1.05);
        }
        .stat-number {
            font-size: 28px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .examples, .results-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            max-height: 500px;
            overflow-y: auto;
        }
        .example-item {
            background: white;
            margin: 15px 0;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .table-container {
            max-height: 600px;
            overflow: auto;
            border: 1px solid #ddd;
            border-radius: 12px;
            margin: 20px 0;
            background: white;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        .data-table th, .data-table td {
            border: 1px solid #ddd;
            padding: 12px 8px;
            text-align: left;
            max-width: 300px;
            word-wrap: break-word;
        }
        .data-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .data-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        .data-table tr:hover {
            background-color: #e3f2fd;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }
        .copy-button {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }
        .copy-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }

        .hidden { display: none !important; }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Footer */
        .footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
            color: #666;
        }
        .footer a {
            color: #667eea;
            text-decoration: none;
        }
        .footer a:hover {
            text-decoration: underline;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            .header h1 {
                font-size: 2em;
            }
            .github-link {
                position: relative;
                top: auto;
                right: auto;
                display: inline-block;
                margin: 10px 0;
            }
        }
    </style>
</head>
<body>
    <a href="https://github.com/votrenom/analyseur-texte-universel" class="github-link" target="_blank">
        üìö GitHub
    </a>

    <div class="container">
        <div class="header">
            <h1>üîÑ Analyseur de Texte Universel</h1>
            <p>Traitement intelligent de donn√©es textuelles avec 4 modes d'analyse</p>
            <p><em>Version open source - Traitement 100% local et priv√©</em></p>
            <input type="text" id="projectTitle" placeholder="Nom de votre projet (ex: Analyse satisfaction client)" 
                   style="width: 400px; padding: 10px; border: 2px solid #667eea; border-radius: 8px; font-size: 16px; text-align: center;">
        </div>

        <div class="version-info">
            <h4>‚ÑπÔ∏è Version publique gratuite</h4>
            <p>Cette application fonctionne enti√®rement dans votre navigateur. Vos donn√©es ne quittent jamais votre ordinateur.</p>
            <p><strong>Code source :</strong> <a href="https://github.com/votrenom/analyseur-texte-universel" target="_blank">GitHub</a> | 
               <strong>Licence :</strong> MIT | 
               <strong>Support :</strong> Issues GitHub</p>
        </div>

        <div class="limitations">
            <h4>‚ö†Ô∏è Limitations de la version publique</h4>
            <ul>
                <li><strong>Taille max :</strong> 10 000 lignes par fichier</li>
                <li><strong>Fichiers :</strong> 50 MB maximum</li>
                <li><strong>Traduction :</strong> Dictionnaire local uniquement (pas d'API externe)</li>
                <li><strong>Support :</strong> Communaut√© GitHub</li>
            </ul>
        </div>

        <!-- Mode Selector -->
        <div class="mode-selector">
            <h3>üéØ Choisissez votre m√©thode de traitement</h3>
            <div class="mode-cards">
                <div class="mode-card" data-mode="auto">
                    <h4>ü§ñ Correspondances Automatiques</h4>
                    <p>G√©n√©ration automatique des correspondances par analyse de similarit√©</p>
                </div>
                <div class="mode-card" data-mode="custom">
                    <h4>üìã Base Personnalis√©e</h4>
                    <p>Utilisez votre propre dictionnaire de correspondances</p>
                </div>
                <div class="mode-card" data-mode="adaptive">
                    <h4>üß† Apprentissage Adaptatif</h4>
                    <p>L'IA apprend avec vos corrections sur un √©chantillon</p>
                </div>
                <div class="mode-card" data-mode="translate">
                    <h4>üåç Traduction Locale</h4>
                    <p>Traduction darija-fran√ßais avec dictionnaire int√©gr√©</p>
                </div>
            </div>
        </div>

        <!-- Configuration Panels -->
        
        <!-- Mode Automatique -->
        <div id="config-auto" class="config-panel">
            <h3>ü§ñ Configuration - Correspondances Automatiques</h3>
            <div class="file-upload" id="upload-auto-main">
                <strong>üìÑ Fichier principal (r√©ponses √† traiter)</strong>
                <input type="file" id="mainFile-auto" accept=".xlsx,.xls" />
                <p>Fichier contenant les r√©ponses textuelles √† analyser</p>
            </div>
            <div class="file-upload" id="upload-auto-ref">
                <strong>üìã Fichier de r√©f√©rence (cat√©gories cibles)</strong>
                <input type="file" id="refFile-auto" accept=".xlsx,.xls" />
                <p>Fichier contenant la liste des cat√©gories standardis√©es</p>
            </div>
            <div class="parameters">
                <div class="param-group">
                    <label>Seuil de similarit√© (%)</label>
                    <input type="range" id="similarity-threshold" min="50" max="95" value="75" 
                           oninput="document.getElementById('similarity-value').textContent = this.value + '%'">
                    <span id="similarity-value">75%</span>
                </div>
                <div class="param-group">
                    <label>Correspondances max par r√©ponse</label>
                    <select id="max-matches">
                        <option value="1">1</option>
                        <option value="2" selected>2</option>
                        <option value="3">3</option>
                    </select>
                </div>
                <div class="param-group">
                    <label>Longueur min des mots</label>
                    <input type="number" id="min-word-length" value="3" min="2" max="10">
                </div>
            </div>
        </div>

        <!-- Mode Personnalis√© -->
        <div id="config-custom" class="config-panel">
            <h3>üìã Configuration - Base Personnalis√©e</h3>
            <div class="file-upload" id="upload-custom-main">
                <strong>üìÑ Fichier principal (r√©ponses √† traiter)</strong>
                <input type="file" id="mainFile-custom" accept=".xlsx,.xls" />
            </div>
            <div class="file-upload" id="upload-custom-ref">
                <strong>üìã Fichier de r√©f√©rence (cat√©gories cibles)</strong>
                <input type="file" id="refFile-custom" accept=".xlsx,.xls" />
            </div>
            <div class="file-upload" id="upload-custom-dict">
                <strong>üìö Fichier de correspondances (votre dictionnaire)</strong>
                <input type="file" id="dictFile-custom" accept=".xlsx,.xls" />
                <p>Format: Colonne A = Termes source, Colonne B = Cat√©gories cibles</p>
            </div>
        </div>

        <!-- Mode Adaptatif -->
        <div id="config-adaptive" class="config-panel">
            <h3>üß† Configuration - Apprentissage Adaptatif</h3>
            <div class="file-upload" id="upload-adaptive-main">
                <strong>üìÑ Fichier principal (r√©ponses √† traiter)</strong>
                <input type="file" id="mainFile-adaptive" accept=".xlsx,.xls" />
            </div>
            <div class="file-upload" id="upload-adaptive-ref">
                <strong>üìã Fichier de r√©f√©rence (cat√©gories cibles)</strong>
                <input type="file" id="refFile-adaptive" accept=".xlsx,.xls" />
            </div>
            <div class="parameters">
                <div class="param-group">
                    <label>Taille de l'√©chantillon</label>
                    <select id="sample-size">
                        <option value="20">20 r√©ponses</option>
                        <option value="50" selected>50 r√©ponses</option>
                        <option value="100">100 r√©ponses</option>
                    </select>
                </div>
                <div class="param-group">
                    <label>Confiance minimale (%)</label>
                    <input type="range" id="confidence-threshold" min="50" max="90" value="70"
                           oninput="document.getElementById('confidence-value').textContent = this.value + '%'">
                    <span id="confidence-value">70%</span>
                </div>
            </div>
        </div>

        <!-- Mode Traduction -->
        <div id="config-translate" class="config-panel">
            <h3>üåç Configuration - Traduction Locale</h3>
            <div class="file-upload" id="upload-translate-main">
                <strong>üìÑ Fichier principal (r√©ponses √† traiter)</strong>
                <input type="file" id="mainFile-translate" accept=".xlsx,.xls" />
            </div>
            <div class="file-upload" id="upload-translate-ref">
                <strong>üìã Fichier de r√©f√©rence (cat√©gories cibles)</strong>
                <input type="file" id="refFile-translate" accept=".xlsx,.xls" />
            </div>
            <div class="parameters">
                <div class="param-group">
                    <label>Langue source</label>
                    <select id="source-language">
                        <option value="ar">Darija (Dialecte marocain)</option>
                        <option value="fr">Fran√ßais</option>
                        <option value="en">Anglais</option>
                    </select>
                </div>
                <div class="param-group">
                    <label>Langue cible</label>
                    <select id="target-language">
                        <option value="fr" selected>Fran√ßais</option>
                        <option value="en">Anglais</option>
                        <option value="ar">Arabe</option>
                    </select>
                </div>
                <div class="param-group">
                    <label>Dictionnaire</label>
                    <select id="translation-service" disabled>
                        <option value="local" selected>Dictionnaire int√©gr√© (50+ termes)</option>
                    </select>
                    <small>Version publique: dictionnaire local uniquement</small>
                </div>
            </div>
        </div>

        <!-- Processing Button -->
        <div style="text-align: center; margin: 30px 0;">
            <button id="processBtn" class="button" onclick="lancerTraitement()" disabled>
                üöÄ Lancer le Traitement
            </button>
        </div>

        <!-- Status -->
        <div id="status" class="status info hidden">
            Pr√™t √† traiter...
        </div>

        <!-- Progress Bar -->
        <div id="progressContainer" class="hidden">
            <h4>Progression du traitement</h4>
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
            </div>
            <p id="progressText">Initialisation...</p>
        </div>

        <!-- Learning Interface (Mode Adaptatif) -->
        <div id="learningInterface" class="learning-interface hidden">
            <h3>üéì Interface d'Apprentissage</h3>
            <p>Validez les correspondances sugg√©r√©es pour am√©liorer l'analyse :</p>
            <div id="learningItems"></div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="button" onclick="appliquerApprentissage()">
                    ‚úÖ Appliquer l'Apprentissage
                </button>
            </div>
        </div>

        <!-- Results -->
        <div id="statsContainer" class="hidden">
            <h3>üìä Statistiques du Traitement</h3>
            <div class="stats" id="stats"></div>
        </div>

        <div id="examplesContainer" class="hidden">
            <h3>üìù Exemples de Traitement</h3>
            <div class="examples" id="examples"></div>
        </div>

        <div id="downloadContainer" class="hidden">
            <h3>üíæ R√©sultats du Traitement</h3>
            <div class="action-buttons" id="downloadLinks"></div>
            <div id="tableContainer"></div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>
                <strong>Analyseur de Texte Universel</strong> v2.0.0 - 
                <a href="https://github.com/votrenom/analyseur-texte-universel" target="_blank">Code source</a> | 
                <a href="https://github.com/votrenom/analyseur-texte-universel/issues" target="_blank">Support</a> | 
                <a href="https://github.com/votrenom/analyseur-texte-universel/blob/main/LICENSE" target="_blank">Licence MIT</a>
            </p>
            <p>
                <small>Traitement 100% local - Vos donn√©es restent priv√©es | 
                Cr√©√© avec ‚ù§Ô∏è pour la communaut√© open source</small>
            </p>
        </div>
    </div>

    <script>
        // Configuration pour version publique
        const PUBLIC_VERSION = true;
        const MAX_FILE_SIZE = 50 * 1024 * 1024; // 50MB
        const MAX_PROCESSING_ROWS = 10000; // 10k lignes max

        // Variables globales
        let currentMode = null;
        let filesData = {
            main: null,
            reference: null,
            dictionary: null
        };
        let processedData = null;
        let learningData = null;

        // Syst√®me de correspondances int√©gr√© √©tendu pour version publique
        const builtInCorrespondences = {
            // Satisfaction/Insatisfaction
            "ma3tawnich": "Le montant accord√©",
            "montant kaml": "Le montant accord√©", 
            "le montant": "Le montant accord√©",
            "montant": "Le montant accord√©",
            "le cr√©dit": "Le montant accord√©",
            "bghit": "Le montant accord√©",
            "kaml": "Le montant accord√©",
            
            // Taux et frais
            "taux d'int√©r√™t": "Frais et taux √©lev√©s",
            "taux tal3": "Frais et taux √©lev√©s",
            "les interet": "Frais et taux √©lev√©s",
            "int√©r√™t": "Frais et taux √©lev√©s",
            "interet": "Frais et taux √©lev√©s",
            "frait dossier": "Frais de dossier",
            "frais dossier": "Frais de dossier",
            "les frais": "Frais et taux √©lev√©s",
            "promotions": "Frais et taux √©lev√©s",
            "tal3": "Frais et taux √©lev√©s",
            
            // Service
            "service": "Service client peu r√©actif",
            "traitement": "Lenteur dans le traitement des dossiers",
            "lenteur": "Lenteur dans le traitement des dossiers",
            "retard": "Retard dans le d√©blocage du cr√©dit",
            "accueil": "L'accueil en agence",
            "mauvais traitement": "Mauvais traitement des agents",
            "agents": "Mauvais traitement des agents",
            
            // Processus
            "processus": "Processus Complexe",
            "documents": "Trop de documents requis",
            "papiers": "Trop de documents requis",
            "signature": "Le passage √† l'agence pour la signature",
            "complexe": "Processus Complexe",
            
            // Autres
            "agence": "Indisponibilit√© des agences",
            "passage": "Le passage √† l'agence pour la signature",
            "information": "Manque d'information",
            "manque d'info": "Manque d'information",
            "ambigu√Øt√©": "Ambigu√Øt√©",
            "date": "La date de pr√©l√®vement",
            "pr√©l√®vement": "Retard dans les pr√©l√©vements des traites",
            "d√©blocage": "Retard dans le d√©blocage du cr√©dit",
            "assurance": "Probl√®mes li√©s √† l'assurance",

            // Mots courants g√©n√©riques
            "qualit√©": "Probl√®me de qualit√©",
            "livraison": "Probl√®me de livraison",
            "prix": "Prix trop √©lev√©",
            "rapide": "Rapidit√© satisfaisante",
            "lent": "Lenteur du service",
            "bon": "Satisfaction g√©n√©rale",
            "mauvais": "Insatisfaction g√©n√©rale",
            "excellent": "Tr√®s satisfait",
            "nul": "Tr√®s insatisfait",
            "parfait": "Parfaitement satisfait",
            
            // Termes darija √©tendus
            "zwin": "Bon",
            "khayb": "Mauvais",
            "bezzaf": "Beaucoup",
            "shwiya": "Un peu",
            "mezyan": "Bon",
            "ma3endish": "Je n'ai pas",
            "katb9a": "√áa reste",
            "mashi": "Pas",
            "wakha": "M√™me si",
            "ila": "Si",
            "walakin": "Mais"
        };

        // Dictionnaire de traduction darija-fran√ßais √©tendu
        const translationDict = {
            "ma3tawnich": "ils ne m'ont pas donn√©",
            "bghit": "je veux",
            "kaml": "complet",
            "tal3": "√©lev√©",
            "zwin": "bien",
            "khayb": "mauvais",
            "bezzaf": "beaucoup",
            "shwiya": "un peu",
            "mezyan": "bon",
            "ma3endish": "je n'ai pas",
            "katb9a": "√ßa reste",
            "mashi": "pas",
            "wakha": "m√™me si",
            "ila": "si",
            "walakin": "mais",
            "o": "et",
            "aw": "ou",
            "f": "dans",
            "m3a": "avec",
            "bla": "sans",
            "kter": "plus",
            "9lil": "moins",
            "kbir": "grand",
            "sghir": "petit",
            "jdid": "nouveau",
            "9dim": "ancien",
            "s3ib": "difficile",
            "sahel": "facile"
        };

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            updateProjectTitle();
            showWelcomeMessage();
        });

        function showWelcomeMessage() {
            updateStatus('üëã Bienvenue! S√©lectionnez un mode de traitement pour commencer.', 'info');
        }

        function setupEventListeners() {
            // Mode selection
            document.querySelectorAll('.mode-card').forEach(card => {
                card.addEventListener('click', function() {
                    selectMode(this.dataset.mode);
                });
            });

            // File uploads pour chaque mode
            const modes = ['auto', 'custom', 'adaptive', 'translate'];
            modes.forEach(mode => {
                const mainFileInput = document.getElementById(`mainFile-${mode}`);
                const refFileInput = document.getElementById(`refFile-${mode}`);
                
                if (mainFileInput) {
                    mainFileInput.addEventListener('change', function(e) {
                        handleFileUpload(e, 'main', mode);
                    });
                }
                
                if (refFileInput) {
                    refFileInput.addEventListener('change', function(e) {
                        handleFileUpload(e, 'reference', mode);
                    });
                }
            });

            // Dictionnaire pour mode personnalis√©
            const dictFileInput = document.getElementById('dictFile-custom');
            if (dictFileInput) {
                dictFileInput.addEventListener('change', function(e) {
                    handleFileUpload(e, 'dictionary', 'custom');
                });
            }

            // Projet title
            document.getElementById('projectTitle').addEventListener('input', updateProjectTitle);
        }

        function selectMode(mode) {
            currentMode = mode;
            
            // Update visual selection
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`[data-mode="${mode}"]`).classList.add('selected');
            
            // Show appropriate config panel
            document.querySelectorAll('.config-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.getElementById(`config-${mode}`).classList.add('active');
            
            // Reset files and button state
            resetFilesAndButton();
            updateStatus('Mode s√©lectionn√©: ' + getModeDisplayName(mode), 'info');
        }

        function getModeDisplayName(mode) {
            const names = {
                'auto': 'Correspondances Automatiques',
                'custom': 'Base Personnalis√©e',
                'adaptive': 'Apprentissage Adaptatif',
                'translate': 'Traduction Locale'
            };
            return names[mode] || mode;
        }

        function handleFileUpload(event, fileType, mode) {
            const file = event.target.files[0];
            if (!file) return;

            // V√©rification de la taille du fichier
            if (PUBLIC_VERSION && file.size > MAX_FILE_SIZE) {
                alert(`‚ùå Fichier trop volumineux! Maximum ${MAX_FILE_SIZE / (1024*1024)}MB autoris√©.`);
                event.target.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                filesData[fileType] = new Uint8Array(e.target.result);
                
                // Update UI
                const uploadDiv = event.target.closest('.file-upload');
                uploadDiv.classList.add('file-uploaded');
                
                checkReadyToProcess();
            };
            reader.readAsArrayBuffer(file);
        }

        function resetFilesAndButton() {
            filesData = { main: null, reference: null, dictionary: null };
            document.querySelectorAll('.file-upload').forEach(div => {
                div.classList.remove('file-uploaded');
            });
            document.getElementById('processBtn').disabled = true;
        }

        function checkReadyToProcess() {
            const processBtn = document.getElementById('processBtn');
            let ready = false;

            switch(currentMode) {
                case 'auto':
                case 'adaptive':
                case 'translate':
                    ready = filesData.main && filesData.reference;
                    break;
                case 'custom':
                    ready = filesData.main && filesData.reference && filesData.dictionary;
                    break;
            }

            processBtn.disabled = !ready;
            
            if (ready) {
                updateStatus('‚úÖ Fichiers charg√©s! Pr√™t pour le traitement.', 'success');
            }
        }

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = message;
            statusDiv.classList.remove('hidden');
        }

        function updateProgress(percent, text) {
            const progressContainer = document.getElementById('progressContainer');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            progressContainer.classList.remove('hidden');
            progressFill.style.width = percent + '%';
            progressText.textContent = text;
        }

        function updateProjectTitle() {
            const title = document.getElementById('projectTitle').value;
            if (title) {
                document.querySelector('.header h1').textContent = `üîÑ ${title}`;
            } else {
                document.querySelector('.header h1').textContent = 'üîÑ Analyseur de Texte Universel';
            }
        }

        // Fonctions de traitement principal avec limitations version publique
        async function lancerTraitement() {
            if (!currentMode || !filesData.main || !filesData.reference) {
                updateStatus('‚ùå Veuillez s√©lectionner un mode et charger les fichiers requis.', 'error');
                return;
            }

            try {
                updateStatus('üîÑ D√©marrage du traitement...', 'info');
                updateProgress(0, 'Initialisation...');

                // Lire les fichiers
                updateProgress(10, 'Lecture des fichiers...');
                const mainData = await readExcelFile(filesData.main);
                
                // V√©rification des limitations version publique
                if (PUBLIC_VERSION && mainData.length > MAX_PROCESSING_ROWS) {
                    updateStatus(`‚ùå Trop de lignes! Maximum ${MAX_PROCESSING_ROWS} lignes autoris√© en version publique.`, 'error');
                    return;
                }

                const refData = await readExcelFile(filesData.reference);
                let dictData = null;
                
                if (currentMode === 'custom' && filesData.dictionary) {
                    dictData = await readExcelFile(filesData.dictionary);
                }

                updateProgress(20, 'Analyse de la structure des donn√©es...');
                
                // D√©tecter les colonnes automatiquement
                const mainColumns = Object.keys(mainData[0]);
                const responseColumn = detectResponseColumn(mainData[0]);
                const idColumn = mainColumns[0]; // Premi√®re colonne = ID
                
                // Extraire les cat√©gories de r√©f√©rence
                const refColumns = Object.keys(refData[0]);
                const categoryColumn = refColumns.find(col => 
                    col.toLowerCase().includes('raison') || 
                    col.toLowerCase().includes('cat√©gorie') ||
                    col.toLowerCase().includes('motif')
                ) || refColumns[0];
                
                const referenceCategories = refData.map(row => row[categoryColumn]).filter(cat => cat && cat.toString().trim());

                updateProgress(30, 'Pr√©paration du syst√®me d\'analyse...');

                let correspondences = {};
                let processedResults = [];

                // Traitement selon le mode s√©lectionn√©
                switch(currentMode) {
                    case 'auto':
                        correspondences = await generateAutomaticCorrespondences(mainData, referenceCategories, responseColumn);
                        processedResults = await processWithCorrespondences(mainData, correspondences, responseColumn, idColumn);
                        break;
                        
                    case 'custom':
                        correspondences = await loadCustomCorrespondences(dictData);
                        processedResults = await processWithCorrespondences(mainData, correspondences, responseColumn, idColumn);
                        break;
                        
                    case 'adaptive':
                        return await processAdaptiveMode(mainData, referenceCategories, responseColumn, idColumn);
                        
                    case 'translate':
                        correspondences = await generateTranslationCorrespondences(mainData, referenceCategories, responseColumn);
                        processedResults = await processWithCorrespondences(mainData, correspondences, responseColumn, idColumn);
                        break;
                }

                updateProgress(90, 'Finalisation...');
                await finalizeResults(processedResults, mainData, responseColumn);
                updateProgress(100, 'Traitement termin√©!');

            } catch (error) {
                updateStatus(`‚ùå Erreur: ${error.message}`, 'error');
                console.error('Erreur de traitement:', error);
            }
        }

        async function readExcelFile(fileData) {
            const workbook = XLSX.read(fileData);
            const sheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[sheetName];
            return XLSX.utils.sheet_to_json(worksheet);
        }

        function detectResponseColumn(firstRow) {
            const columns = Object.keys(firstRow);
            
            // Chercher des colonnes avec des mots-cl√©s sp√©cifiques
            const keywords = ['r√©ponse', 'motif', 'raison', 'commentaire', 'quels', 'pourquoi', 'insatisfait'];
            
            for (const keyword of keywords) {
                const found = columns.find(col => 
                    col.toLowerCase().includes(keyword)
                );
                if (found) return found;
            }
            
            // Sinon, prendre la deuxi√®me colonne (apr√®s l'ID)
            return columns[1] || columns[0];
        }

        // Reste du code JavaScript identique √† la version compl√®te...
        // (inclure toutes les autres fonctions)

        // Mode 1: Correspondances Automatiques
        async function generateAutomaticCorrespondences(mainData, referenceCategories, responseColumn) {
            updateProgress(40, 'G√©n√©ration des correspondances automatiques...');
            
            const threshold = parseInt(document.getElementById('similarity-threshold').value) / 100;
            const minWordLength = parseInt(document.getElementById('min-word-length').value);
            
            // Extraire tous les mots des r√©ponses
            const allWords = new Set();
            mainData.forEach(row => {
                const response = row[responseColumn];
                if (response) {
                    const words = response.toString().toLowerCase()
                        .split(/[\s,.-]+/)
                        .filter(word => word.length >= minWordLength);
                    words.forEach(word => allWords.add(word));
                }
            });

            const correspondences = { ...builtInCorrespondences };
            
            // G√©n√©rer des correspondances automatiques
            for (const word of allWords) {
                if (!correspondences[word]) {
                    const bestMatch = findBestCategoryMatch(word, referenceCategories, threshold);
                    if (bestMatch) {
                        correspondences[word] = bestMatch;
                    }
                }
            }

            updateProgress(60, 'Correspondances g√©n√©r√©es...');
            return correspondences;
        }

        function findBestCategoryMatch(word, categories, threshold) {
            let bestMatch = null;
            let bestScore = 0;

            for (const category of categories) {
                const score = calculateSimilarity(word, category.toLowerCase());
                if (score > bestScore && score >= threshold) {
                    bestScore = score;
                    bestMatch = category;
                }
            }

            return bestMatch;
        }

        function calculateSimilarity(str1, str2) {
            // Algorithme de similarit√© simple bas√© sur les caract√®res communs
            const set1 = new Set(str1.toLowerCase());
            const set2 = new Set(str2.toLowerCase());
            const intersection = new Set([...set1].filter(x => set2.has(x)));
            const union = new Set([...set1, ...set2]);
            return intersection.size / union.size;
        }

        // Mode 2: Base Personnalis√©e
        async function loadCustomCorrespondences(dictData) {
            updateProgress(40, 'Chargement du dictionnaire personnalis√©...');
            
            const correspondences = {};
            const columns = Object.keys(dictData[0]);
            const sourceCol = columns[0]; // Premi√®re colonne = termes source
            const targetCol = columns[1]; // Deuxi√®me colonne = cat√©gories cibles
            
            dictData.forEach(row => {
                const source = row[sourceCol];
                const target = row[targetCol];
                if (source && target) {
                    correspondences[source.toString().toLowerCase().trim()] = target.toString().trim();
                }
            });

            updateProgress(60, 'Dictionnaire charg√©...');
            return correspondences;
        }

        // Mode 3: Apprentissage Adaptatif
        async function processAdaptiveMode(mainData, referenceCategories, responseColumn, idColumn) {
            updateProgress(40, 'Pr√©paration de l\'√©chantillon d\'apprentissage...');
            
            const sampleSize = parseInt(document.getElementById('sample-size').value);
            const sample = mainData.slice(0, sampleSize);
            
            // G√©n√©rer des suggestions initiales
            const initialCorrespondences = { ...builtInCorrespondences };
            
            learningData = {
                sample: sample,
                correspondences: initialCorrespondences,
                referenceCategories: referenceCategories,
                responseColumn: responseColumn,
                idColumn: idColumn,
                fullData: mainData
            };

            updateProgress(60, 'G√©n√©ration des suggestions...');
            await displayLearningInterface(sample, responseColumn, idColumn, referenceCategories);
            
            updateProgress(70, 'Interface d\'apprentissage pr√™te');
            updateStatus('üéì Veuillez valider les correspondances dans l\'interface d\'apprentissage ci-dessous.', 'info');
        }

        async function displayLearningInterface(sample, responseColumn, idColumn, referenceCategories) {
            const learningInterface = document.getElementById('learningInterface');
            const learningItems = document.getElementById('learningItems');
            
            learningItems.innerHTML = '';
            
            sample.forEach((row, index) => {
                const response = row[responseColumn];
                if (!response || response.toString().trim() === '') return;
                
                const suggestions = analyzeResponseForLearning(response, referenceCategories);
                
                const itemDiv = document.createElement('div');
                itemDiv.className = 'sample-item';
                itemDiv.innerHTML = `
                    <div class="sample-response">ID ${row[idColumn]}: "${response}"</div>
                    <div>Cat√©gories sugg√©r√©es:</div>
                    <div class="suggested-categories" data-response-index="${index}">
                        ${suggestions.map(cat => 
                            `<span class="category-tag" onclick="toggleCategory(this)">${cat}</span>`
                        ).join('')}
                    </div>
                    <div style="margin-top: 10px;">
                        <input type="text" placeholder="Ajouter une nouvelle cat√©gorie..." 
                               onkeypress="if(event.key==='Enter') addNewCategory(this, ${index})"
                               style="width: 100%; padding: 5px; border: 1px solid #ccc; border-radius: 4px;">
                    </div>
                `;
                
                learningItems.appendChild(itemDiv);
            });
            
            learningInterface.classList.remove('hidden');
        }

        function analyzeResponseForLearning(response, referenceCategories) {
            const responseText = response.toString().toLowerCase();
            const suggestions = [];
            
            // Utiliser les correspondances int√©gr√©es
            for (const [keyword, category] of Object.entries(builtInCorrespondences)) {
                if (responseText.includes(keyword.toLowerCase())) {
                    if (referenceCategories.includes(category) && !suggestions.includes(category)) {
                        suggestions.push(category);
                    }
                }
            }
            
            // Si aucune suggestion, proposer "Non identifi√©"
            if (suggestions.length === 0) {
                suggestions.push("Non identifi√©");
            }
            
            return suggestions.slice(0, 3); // Maximum 3 suggestions
        }

        function toggleCategory(element) {
            element.classList.toggle('rejected');
        }

        function addNewCategory(input, responseIndex) {
            const newCategory = input.value.trim();
            if (!newCategory) return;
            
            const container = input.parentElement.previousElementSibling;
            const newTag = document.createElement('span');
            newTag.className = 'category-tag';
            newTag.textContent = newCategory;
            newTag.onclick = function() { toggleCategory(this); };
            
            container.appendChild(newTag);
            input.value = '';
        }

        async function appliquerApprentissage() {
            updateProgress(70, 'Application de l\'apprentissage...');
            
            // Collecter les correspondances valid√©es
            const validatedCorrespondences = { ...learningData.correspondences };
            
            document.querySelectorAll('.sample-item').forEach((item, index) => {
                const responseElement = item.querySelector('.sample-response');
                const response = responseElement.textContent.split(': "')[1].slice(0, -1); // Extraire la r√©ponse
                
                const validCategories = [];
                item.querySelectorAll('.category-tag:not(.rejected)').forEach(tag => {
                    validCategories.push(tag.textContent);
                });
                
                // Cr√©er des correspondances bas√©es sur les mots-cl√©s de la r√©ponse
                const words = response.toLowerCase().split(/[\s,.-]+/).filter(w => w.length > 2);
                words.forEach(word => {
                    if (validCategories.length > 0) {
                        validatedCorrespondences[word] = validCategories[0]; // Prendre la premi√®re cat√©gorie valide
                    }
                });
            });
            
            // Appliquer sur toutes les donn√©es
            const processedResults = await processWithCorrespondences(
                learningData.fullData, 
                validatedCorrespondences, 
                learningData.responseColumn, 
                learningData.idColumn
            );
            
            document.getElementById('learningInterface').classList.add('hidden');
            await finalizeResults(processedResults, learningData.fullData, learningData.responseColumn);
            updateProgress(100, 'Apprentissage appliqu√© avec succ√®s!');
        }

        // Mode 4: Traduction Automatique
        async function generateTranslationCorrespondences(mainData, referenceCategories, responseColumn) {
            updateProgress(40, 'Traduction des r√©ponses...');
            
            const correspondences = {};
            
            // Extraire les mots uniques
            const uniqueWords = new Set();
            mainData.forEach(row => {
                const response = row[responseColumn];
                if (response) {
                    const words = response.toString().toLowerCase().split(/[\s,.-]+/);
                    words.forEach(word => {
                        if (word.length > 2) uniqueWords.add(word);
                    });
                }
            });
            
            // Traduire chaque mot
            for (const word of uniqueWords) {
                const translated = translateWord(word);
                if (translated !== word) {
                    const bestMatch = findBestCategoryMatch(translated, referenceCategories, 0.3);
                    if (bestMatch) {
                        correspondences[word] = bestMatch;
                    }
                }
            }
            
            // Ajouter les correspondances int√©gr√©es
            Object.assign(correspondences, builtInCorrespondences);
            
            updateProgress(60, 'Traductions g√©n√©r√©es...');
            return correspondences;
        }

        function translateWord(word) {
            // Traduction simple bas√©e sur le dictionnaire int√©gr√©
            const lowerWord = word.toLowerCase();
            return translationDict[lowerWord] || word;
        }

        // Traitement avec correspondances
        async function processWithCorrespondences(mainData, correspondences, responseColumn, idColumn) {
            updateProgress(70, 'Application des correspondances...');
            
            const maxMatches = currentMode === 'auto' ? parseInt(document.getElementById('max-matches').value) : 2;
            const results = [];
            
            mainData.forEach((row, index) => {
                const response = row[responseColumn];
                const processedRow = { ...row };
                
                // Ajouter les colonnes de r√©sultats
                for (let i = 1; i <= maxMatches; i++) {
                    processedRow[`Cat√©gorie ${i}`] = '';
                }
                
                if (response && response.toString().trim() !== '') {
                    const categories = analyzeResponse(response, correspondences);
                    
                    categories.slice(0, maxMatches).forEach((category, i) => {
                        processedRow[`Cat√©gorie ${i + 1}`] = category;
                    });
                }
                
                results.push(processedRow);
                
                if (index % 100 === 0) {
                    updateProgress(70 + (index / mainData.length) * 15, `Traitement: ${index + 1}/${mainData.length}`);
                }
            });
            
            return results;
        }

        function analyzeResponse(response, correspondences) {
            const responseText = response.toString().toLowerCase().trim();
            
            // Cas sp√©ciaux
            if (['rien', 'aucun', 'non', 'n√©ant', ''].includes(responseText)) {
                return [];
            }
            
            const foundCategories = [];
            
            // Rechercher les correspondances
            for (const [keyword, category] of Object.entries(correspondences)) {
                if (responseText.includes(keyword.toLowerCase())) {
                    if (!foundCategories.includes(category)) {
                        foundCategories.push(category);
                    }
                }
            }
            
            // Si aucune correspondance trouv√©e
            if (foundCategories.length === 0) {
                foundCategories.push("Non identifi√©");
            }
            
            return foundCategories;
        }

        // Finalisation des r√©sultats
        async function finalizeResults(processedResults, originalData, responseColumn) {
            processedData = processedResults;
            
            // Calculer les statistiques
            const stats = calculateStats(processedResults, responseColumn);
            displayStats(stats);
            
            // G√©n√©rer des exemples
            const examples = generateExamples(processedResults, responseColumn, 10);
            displayExamples(examples);
            
            // Pr√©parer l'interface de t√©l√©chargement
            setupDownloadInterface();
            
            updateStatus('‚úÖ Traitement termin√© avec succ√®s!', 'success');
        }

        function calculateStats(data, responseColumn) {
            const stats = {
                total: data.length,
                processed: 0,
                empty: 0,
                withCategories: 0,
                unidentified: 0
            };
            
            data.forEach(row => {
                const response = row[responseColumn];
                if (!response || response.toString().trim() === '') {
                    stats.empty++;
                } else {
                    stats.processed++;
                    
                    const hasCategories = Object.keys(row).some(key => 
                        key.startsWith('Cat√©gorie') && row[key] && row[key] !== ''
                    );
                    
                    if (hasCategories) {
                        stats.withCategories++;
                        
                        const hasUnidentified = Object.keys(row).some(key => 
                            key.startsWith('Cat√©gorie') && row[key] === 'Non identifi√©'
                        );
                        
                        if (hasUnidentified) {
                            stats.unidentified++;
                        }
                    }
                }
            });
            
            return stats;
        }

        function displayStats(stats) {
            const statsContainer = document.getElementById('statsContainer');
            const statsDiv = document.getElementById('stats');
            
            statsDiv.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${stats.total}</div>
                    <div>Total lignes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.processed}</div>
                    <div>Lignes trait√©es</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.empty}</div>
                    <div>Lignes vides</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.withCategories}</div>
                    <div>Avec cat√©gories</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.unidentified}</div>
                    <div>Non identifi√©es</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${Math.round((stats.withCategories / stats.processed) * 100)}%</div>
                    <div>Taux de r√©ussite</div>
                </div>
            `;
            
            statsContainer.classList.remove('hidden');
        }

        function generateExamples(data, responseColumn, count) {
            const examples = [];
            const processedData = data.filter(row => 
                row[responseColumn] && row[responseColumn].toString().trim() !== ''
            );
            
            for (let i = 0; i < Math.min(count, processedData.length); i++) {
                const row = processedData[i];
                const categories = Object.keys(row)
                    .filter(key => key.startsWith('Cat√©gorie'))
                    .map(key => row[key])
                    .filter(cat => cat && cat !== '');
                
                examples.push({
                    id: Object.values(row)[0], // Premier champ = ID
                    response: row[responseColumn],
                    categories: categories
                });
            }
            
            return examples;
        }

        function displayExamples(examples) {
            const examplesContainer = document.getElementById('examplesContainer');
            const examplesDiv = document.getElementById('examples');
            
            let htmlExamples = '';
            examples.forEach(example => {
                htmlExamples += `
                    <div class="example-item">
                        <strong>ID:</strong> ${example.id}<br>
                        <strong>R√©ponse:</strong> "${example.response}"<br>
                        <strong>Cat√©gories:</strong> ${example.categories.join(', ') || 'Aucune'}
                    </div>
                `;
            });
            
            examplesDiv.innerHTML = htmlExamples;
            examplesContainer.classList.remove('hidden');
        }

        function setupDownloadInterface() {
            const downloadContainer = document.getElementById('downloadContainer');
            const downloadLinks = document.getElementById('downloadLinks');
            
            downloadLinks.innerHTML = `
                <button class="copy-button" onclick="displayTable()">
                    üìã Afficher le tableau
                </button>
                <button class="copy-button" onclick="exportCSV()">
                    üìÑ Exporter CSV
                </button>
                <button class="copy-button" onclick="exportExcel()">
                    üìä Exporter Excel
                </button>
                <button class="copy-button" onclick="copyTableData()">
                    üìé Copier les donn√©es
                </button>
            `;
            
            downloadContainer.classList.remove('hidden');
        }

        function displayTable() {
            const tableContainer = document.getElementById('tableContainer');
            
            if (!processedData || processedData.length === 0) {
                tableContainer.innerHTML = '<p>Aucune donn√©e √† afficher</p>';
                return;
            }

            const columns = Object.keys(processedData[0]);
            let html = `
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                ${columns.map(col => `<th>${col}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
            `;

            // Limiter l'affichage pour la performance
            const displayLimit = PUBLIC_VERSION ? 1000 : processedData.length;
            const dataToShow = processedData.slice(0, displayLimit);

            dataToShow.forEach(row => {
                html += '<tr>';
                columns.forEach(col => {
                    const value = row[col] || '';
                    html += `<td>${value.toString()}</td>`;
                });
                html += '</tr>';
            });

            if (processedData.length > displayLimit) {
                html += `<tr><td colspan="${columns.length}" style="text-align: center; color: #666; font-style: italic;">
                    ... et ${processedData.length - displayLimit} autres lignes (utilisez l'export pour voir toutes les donn√©es)
                </td></tr>`;
            }

            html += `
                        </tbody>
                    </table>
                </div>
            `;

            tableContainer.innerHTML = html;
        }

        function exportCSV() {
            if (!processedData || processedData.length === 0) return;

            const columns = Object.keys(processedData[0]);
            let csv = columns.join(',') + '\n';

            processedData.forEach(row => {
                const values = columns.map(col => {
                    let value = (row[col] || '').toString();
                    if (value.includes(',') || value.includes('"') || value.includes('\n')) {
                        value = '"' + value.replace(/"/g, '""') + '"';
                    }
                    return value;
                });
                csv += values.join(',') + '\n';
            });

            downloadFile(csv, 'resultats_analyse.csv', 'text/csv');
        }

        function exportExcel() {
            if (!processedData || processedData.length === 0) return;

            const ws = XLSX.utils.json_to_sheet(processedData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'R√©sultats');
            
            const filename = `resultats_analyse_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, filename);
        }

        function copyTableData() {
            if (!processedData || processedData.length === 0) return;

            const columns = Object.keys(processedData[0]);
            let text = columns.join('\t') + '\n';

            processedData.forEach(row => {
                const values = columns.map(col => (row[col] || '').toString().replace(/\t/g, ' '));
                text += values.join('\t') + '\n';
            });

            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ Donn√©es copi√©es dans le presse-papiers!');
            }).catch(() => {
                // Fallback
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('‚úÖ Donn√©es copi√©es dans le presse-papiers!');
            });
        }

        function downloadFile(content, filename, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
        }

        // Analytics simple (optionnel - version publique)
        if (PUBLIC_VERSION) {
            window.addEventListener('load', function() {
                // Tracker simple d'utilisation (anonyme)
                console.log('üîÑ Analyseur de Texte Universel v2.0.0 - Version publique charg√©e');
            });
        }
    </script>
</body>
</html>